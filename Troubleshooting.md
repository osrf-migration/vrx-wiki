# Contents
[TOC]


# Setup and Install #

## Docker ##

### Networking ###

#### Docker DNS Trouble ####
The symptom is that you cannot get network access from within your Docker container.  We can test the container network access with...

```docker run busybox nslookup google.com```  

If the system returns something like…
```
$ docker run busybox nslookup google.com
Server:    172.20.20.11
Address 1: 172.20.20.11 lee.ern.nps.edu

Name:      google.com
Address 1: 2607:f8b0:4005:804::200e sfo07s13-in-x0e.1e100.net
Address 2: 216.58.195.78 sfo07s16-in-f78.1e100.net
```
then the system has network access and we can proceed with building the VMRC container.

If the system hangs for a long time (~5 min) and returns something like
```
Server:    8.8.8.8
Address 1: 8.8.8.8

nslookup: can't resolve 'google.com'
```
then we have a network problem. The likely cause is that we can’t use the default DNS.

We can verify that this is the case by temporarily providing an explicit DNS to the docker run command.

 1. Find out what DNS your host is using...
```
$ nmcli dev show | grep 'IP4.DNS'
IP4.DNS[1]:                             172.20.20.11
IP4.DNS[2]:                             172.10.20.12
```
 2. Repeat the nslookup using your DNS
```
$ docker run --dns 172.20.20.11 busybox nslookup google.com
Server:    172.20.20.11
Address 1: 172.20.20.11 lee.ern.nps.edu

Name:      google.com
Address 1: 2607:f8b0:4005:807::200e sfo07s16-in-x0e.1e100.net
Address 2: 216.58.195.78 sfo07s16-in-f78.1e100.net
```

We have tried configuring docker to use a specific DNS in two ways
 1. Add the following line to the /etc/docker/daemon.json file ```{ "dns": ["172.20.20.11", "172.10.20.12"] }```
 2. Add the following lines to the /etc/default/docker file
```
# Use DOCKER_OPTS to modify the daemon startup options.
DOCKER_OPTS="--dns 172.20.20.11 --dns 172.10.20.12"
```

For both attempts you need to restart docker: ```docker run busybox less /etc/resolv.conf``` and then rerun the nslookup test or try ```docker run busybox less /etc/resolv.conf```  If this test returns 
```
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

nameserver 8.8.8.8
nameserver 8.8.4.4
```
then we likely still don't have access.




References:

 * https://stackoverflow.com/questions/24151129/docker-network-calls-fail-during-image-build-on-corporate-network
 * https://development.robinwinslow.uk/2016/06/23/fix-docker-networking-dns/