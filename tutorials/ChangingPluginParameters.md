# Overview #

The RobotX-specific behavior of the models and the environment is generated by a set of [Gazebo Model Plugins](http://gazebosim.org/tutorials?tut=plugins_hello_world).  The current models used in these plugins are described in [the Documentation Wiki: Gazebo Plugins](https://bitbucket.org/osrf/vrx/wiki/VRXGazeboPlugins).  The parameters of the associated models (USV drag coefficient, wind speed, etc.) can be changed through the use of SDF configuration files.

This tutorial briefly describes where the base parameter files that are included with this repository are stored so that users can change the parameters to test their solutions under a variety of conditions.

| Description | File Location | Notes |
|-------------|---------------|------ |
| Hydrodynamic parameters (drag, added mass, etc.) | wamv_gazebo/urdf/dynamics/wamv_gazebo_dynamics_plugin.xacro | Current parameters based on FAU Publication https://doi.org/10.1016/j.oceaneng.2016.09.037 |
| Wave characteristics (amplitude, period and direction for three constituents) |  wamv_gazebo/urdf/dynamics/wamv_gazebo_dynamics_plugin.xacro | Values correspond to same values used in visual texture |
| Propulsion characteristics (linear or nonlinear mapping and force limits) | wamv_gazebo/urdf/thruster_layouts/wamv_gazebo_thruster_config.xacro | Nonlinear mapping is based on experimental results from FAU https://doi.org/10.1016/j.oceaneng.2016.09.037 |
| Wind velocity and windage coefficients | vrx_gazebo/worlds/sandisland.world.xacro and vrx_gazebo/worlds/xacros/usv_wind_plugin.xacro | Windage coefficeints from same FAU report https://doi.org/10.1016/j.oceaneng.2016.09.037 |



# Example: Changing the Wind #
As an illustrative example, we'll go through testing our simulation with different wind conditions.  

 * The default wind parameters (speed, variability, direction, etc.) are defined in the [vrx_gazebo/worlds/xacros/usv_wind_plugin.xacro]/xacros/(https://bitbucket.org/osrf/vrx/src/default/vrx_gazebo/worlds/xacros/usv_wind_plugin.xacro) file.  The file defines an XML macro that is then used when defining Gazebo worlds to specify use of the usv_wind_plugin.  Changing parameters in this file will change the default wind conditions for the simulation.
 * The models affected by the wind and how they are affected is defined in the specific world file.  For example, the [vrx_gazebo/worlds/sandisland.world.xacro](https://bitbucket.org/osrf/vrx/src/default/vrx_gazebo/worlds/sandisland.world.xacro) file calls the usv_wind_gazebo macro defined in the usv_wind_plugin.xacro file and specifies that the wind forces should be applied to the `wamv` model with specific wind coefficients. If you view the sandisland.world.xacro file you will see lines like this...

```
<xacro:include filename="$(find vrx_gazebo)/worlds/xacros/gazebo_wind_plugin.xacro"/>
<xacro:usv_wind_gazebo>
  <wind_objs>
    <wind_obj>         
      <name>wamv</name>
      <link_name>base_link</link_name>
      <coeff_vector>0.5 0.5 0.33</coeff_vector>
    </wind_obj>
  </wind_objs>
</xacro:usv_wind_gazebo>
```
Any number of wind_obj's may be added under wind_objs. Only one link per model is supported.

To change the wind plugin parameters we can do a combination of the following:

 * Change the default wind parameters [vrx_gazebo/worlds/xacros/usv_wind_plugin.xacro]/xacros/(https://bitbucket.org/osrf/vrx/src/default/vrx_gazebo/worlds/xacros/usv_wind_plugin.xacro)
 * Override the default parameters when calling the macro in the [vrx_gazebo/worlds/sandisland.world.xacro](https://bitbucket.org/osrf/vrx/src/default/vrx_gazebo/worlds/sandisland.world.xacro) file.
 * Change the models affected by wind or their coefficients in [vrx_gazebo/worlds/sandisland.world.xacro](https://bitbucket.org/osrf/vrx/src/default/vrx_gazebo/worlds/sandisland.world.xacro).
 * Note: Make sure to run `catkin_make` after any changes to process the XML macros.


NOTE: For another example, see vrx_gazebo/worlds/wind_test.world.xacro

# Example: Changing the Wave Field #

As an illustrative example, we'll go through testing the simulation with different wave scenarios.  The wave field characteristics are defined in `wamv_gazebo/urdf/dynamics/wamv_gazebo_dynamics_plugin.xacro`.  When we open the file we see a section that looks like this...

```
	<!-- Waves x3 -->
	<wave_n>3</wave_n>

	<wave_amp0>0.06</wave_amp0>
	<wave_period0>12.6</wave_period0>
	<wave_direction0>-1 0</wave_direction0>

	<wave_amp1>0.04</wave_amp1>
	<wave_period1>3.7</wave_period1>
	<wave_direction1>-0.7 0.7</wave_direction1>

	<wave_amp2>0.03</wave_amp2>
	<wave_period2>6.3</wave_period2>
	<wave_direction2>0.7 0.7</wave_direction2>
```

This specifies our Gerstner wave field as having three components, where each component has a user-specified  amplitude, period and direction.

When we start testing a new algorithm, we may want to set all of these to zero, so that there is no influence from the wave field.  We could achieve that by setting the amplitude of each component wave to zero - or we could set the `wave_n` parameter to zero so there are no components.

Alternatively, we may want to stress our algorithm by increasing the seastate.  This can be accomplished by increasing the amplitude of the waves and/or changing the wave period.

We've posted a [video](https://vimeo.com/257586610) showing how we would test with three different seastates - including how to break a buoy!